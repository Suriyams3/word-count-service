plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.flyte'
version = '1.0'

repositories {
    mavenCentral()
}

dependencies {
    // Spark dependencies must be 'compileOnly' so they aren't in the Fat JAR
    compileOnly 'org.apache.spark:spark-sql_2.12:3.5.0'
    compileOnly 'org.apache.spark:spark-core_2.12:3.5.0'

    // Add any small 3rd party libs here using 'implementation'
    // to include them in the Fat JAR
}

shadowJar {
    archiveBaseName.set('word-count-service')
    archiveClassifier.set('all')

    // Set the Main-Class for the JAR manifest
    manifest {
        attributes 'Main-Class': 'com.flyte.spark.WordCountApp'
    }

    // Security: Remove signatures from 'provided' jars to avoid SecurityException
    mergeServiceFiles()
    exclude 'META-INF/*.SF'
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/*.RSA'
}

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}